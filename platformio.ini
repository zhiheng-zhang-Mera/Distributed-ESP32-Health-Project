; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; ============================================================
; 姐姐的温馨提示：
; 1. 请将 Wrist 代码保存为 src/Wrist_Host.cpp
; 2. 请将 Ring 代码保存为 src/Ring_or_Belt_S3.cpp
; 3. 烧录时，在侧边栏选择对应的环境 (wrist_host 或 ring_node)
; ============================================================

[platformio]
default_envs = wrist_host ; 默认先编译手腕节点

[env]
; 公共配置：所有节点共享的设置
platform = espressif32
framework = arduino
monitor_speed = 115200
monitor_filters = time, colorize, esp32_exception_decoder

; 自动下载所需的库
lib_deps =
    adafruit/Adafruit GFX Library @ ^1.11.5
    adafruit/Adafruit SSD1306 @ ^2.5.7
    adafruit/Adafruit MPU6050 @ ^2.2.4
    adafruit/Adafruit Unified Sensor @ ^1.1.9
    sparkfun/SparkFun MAX3010x Pulse and Proximity Sensor Library @ ^1.1.2
    ; 这里的 SparkFun 库包含了 heartRate.h

[env:wrist_host]
; ========================================
; 环境 1: 手腕主控 (普通 ESP32 Dev-Kit)
; ========================================
board = esp32dev
upload_speed = 921600

; [关键] 只编译 Wrist 的代码，忽略 Ring 的代码
build_src_filter = +<Wrist_Host.cpp>

build_flags = 
    -D NODE_ROLE_WRIST
    -D CORE_DEBUG_LEVEL=3 ; 开启调试日志

[env:s3_node]
; ========================================
; 环境 2: 戒指/腰带节点 (XIAO ESP32S3)
; ========================================
board = seeed_xiao_esp32s3
upload_speed = 921600

; [关键] 只编译 Ring 的代码，忽略 Wrist 的代码
build_src_filter = +<s3_node.cpp>

; S3 特有的 USB 配置，保证串口能打印
monitor_dtr = 0
monitor_rts = 0

build_flags = 
    -D NODE_ROLE_RING
    -D ARDUINO_USB_MODE=1
    -D ARDUINO_USB_CDC_ON_BOOT=1 ; 这一行最重要，不然插USB没串口数据
    -D CORE_DEBUG_LEVEL=3
    -O2 ; 开启编译器优化，提升算力

; 如果 S3 上传总是失败，尝试把这个改成 115200
; upload_speed = 115200